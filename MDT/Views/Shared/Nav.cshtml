@using MDT.Models;
@using MDT.Models.DTO;
@{
    UserDTO user = (UserDTO)Session["User"];
    GroupDTO group = (GroupDTO)Session["Group"];
    bool isGroupAdmin = user != null && group != null ? WebManager.IsGroupAdmin(group.GroupId, user.UserId) : false;
    bool admin = (bool?)Session["IsAdmin"] ?? false;
}

<nav class="navbar navbar-default" style="vertical-align:middle;background-color: #000;padding:10px;">
    <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse-1" aria-expanded="false">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
    </div>

    <div class="collapse navbar-collapse" id="navbar-collapse-1">
        <ul class="nav navbar-nav">
            @if (user != null)
            {
                <li>@Html.ActionLink("Home", "Index", "Home", null, null)</li>

                if (ViewBag.Groups.Count > 1)
                {
                    <li>
                        <a class="dropdown-toggle" data-toggle="dropdown">
                            Change Group
                            <span class="caret"></span>
                        </a>
                        <ul class="dropdown-menu" style="vertical-align:middle;background-color: #000; color: white; cursor:pointer;">
                            @foreach (var x in ViewBag.Groups)
                            {
                                <li>@Html.ActionLink((string) @x.txt, "ChangeGroup", "User", new {groupId= @x.val }, new { @class = "groups"})</li>
                                
                            }
                        </ul>
                    </li>
                }

            }
        </ul>
        <ul class="nav navbar-nav navbar-right">
            @if (user != null)
            {
                <li>@Html.ActionLink("Sign Out", "SignOut", "Home")</li>
            }
            else
            {
                <li>
                   
                        
                        <span class="fa fa-user fa-2x dropdown-toggle" data-toggle="dropdown" style="vertical-align:middle;background-color: #000; color: white; cursor:pointer;"></span>
                    
                    <ul class="dropdown-menu" style="vertical-align:middle;background-color: #000; color: white; cursor:pointer;">
                        <li>@Html.ActionLink("SignIn", "SignIn", "Home")</li>
                        <li>@Html.ActionLink("Create Account", "CreateUser", "Home")</li>
                    </ul>
                </li>
            }
        </ul>
    </div>
</nav>

<script>
    $(document).ready(function () {
        $(".groups").click(function (event) {
            event.preventDefault();
            $.ajax({

                url: $(this).attr("href"), 
                success: function () {
                    location.reload();
                }
            });
            
        });
    });
   
</script>